name: Lighthouse

on:
  push:
    branches: [master]
  pull_request:

concurrency:
  cancel-in-progress: true
  group: lighthouse-${{ github.head_ref }}

jobs:

  lighthouseci:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set yarn cache up
      uses: c-hive/gha-yarn-cache@v2

    - name: Install dependencies
      run: yarn --frozen-lockfile --prefer-offline

    - name: Install lighthouse
      run: npm install -g @lhci/cli@0.6.x

    - name: Build application
      run: yarn build

    - name: Run lighthouse
      run: lhci autorun
      env:
        LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
